---
author: Николай Курейчик
weight: 1
---

# Анализ выигрышных стратегий в игре "Камешки"

## Условие задачи

Рассмотрим следующую игру. Дана **одна** кучка, в которой находится `n` камней. Два игрока по очереди делают ходы. За один ход игрок может убрать из кучки **1, 2 или 3 камня**. Выигрывает тот игрок, который забирает последний камень.

## Теоретический анализ

### Основные понятия комбинаторной теории игр

Введем формальную классификацию позиций:

- **P-позиция** (проигрышная позиция) - позиция, из которой нет выигрышной стратегии при оптимальной игре противника
- **N-позиция** (выигрышная позиция) - позиция, из которой существует выигрышная стратегия

**Фундаментальные свойства P- и N-позиций:**
1. Терминальная позиция (0 камней) является P-позицией
2. Из N-позиции существует хотя бы один ход в P-позицию
3. Из P-позиции все ходы ведут в N-позиции

### Формальная постановка задачи

Определим функцию выигрышности `W: ℕ → {True, False}`:
- `W(n) = False` если позиция с n камнями проигрышная (P-позиция)
- `W(n) = True` если позиция с n камнями выигрышная (N-позиция)

Рекуррентное соотношение для произвольного n ≥ 1:
W(n) = ¬W(n-1) ∨ ¬W(n-2) ∨ ¬W(n-3)

**Основная теорема.** Для игры с множеством допустимых ходов S = {1, 2, 3} позиция с n камнями является проигрышной (P-позицией) тогда и только тогда, когда n ≡ 0 (mod 4).

### Доказательство теоремы

**Доказательство** проведём методом полной математической индукции.

**База индукции:**
Непосредственной проверкой устанавливаем:
- `W(0) = False` и 0 ≡ 0 (mod 4)
- `W(1) = True` и 1 ≢ 0 (mod 4)
- `W(2) = True` и 2 ≢ 0 (mod 4)
- `W(3) = True` и 3 ≢ 0 (mod 4)

**Предположение индукции:** Для всех k < m выполняется:
W(k) = True ⇔ k ≢ 0 (mod 4)
W(k) = False ⇔ k ≡ 0 (mod 4)

**Шаг индукции:** Рассмотрим n = m.

**Случай 1: m ≡ 0 (mod 4)**
Пусть m = 4k, k ≥ 1. Из этой позиции возможны переходы:
- В 4k - 1 ≡ 3 (mod 4)
- В 4k - 2 ≡ 2 (mod 4)
- В 4k - 3 ≡ 1 (mod 4)

По предположению индукции, все эти позиции являются N-позициями. Следовательно, из позиции m все ходы ведут в N-позиции, что по определению делает m P-позицией.

**Случай 2: m ≡ r (mod 4), где r ∈ {1, 2, 3}**
Из позиции m игрок может убрать ровно r камней, перейдя в позицию m - r ≡ 0 (mod 4). По предположению индукции, эта позиция является P-позицией. Таким образом, существует ход из N-позиции в P-позицию, что доказывает, что m является N-позицией.

Индукционный переход завершён, теорема доказана.

## Алгоритмический анализ

### Вычислительная модель

Граф игры можно представить как ориентированный ациклический граф G = (V, E), где:
- V = {0, 1, 2, ..., n} - множество вершин (позиций)
- E = {(i, j) | i - j ∈ {1, 2, 3} и i > j} - множество рёбер (ходов)

Выигрышность позиций определяется методом обратной индукции, начиная с терминальной вершины 0.

### Оптимальный алгоритм

Для произвольной позиции n ∈ ℕ:
is_winning(n) = (n mod 4 ≠ 0)
winning_move(n) = n mod 4 (если n mod 4 ≠ 0)
**Вычислительная сложность:** O(1) времени, O(1) памяти.

## Теоретические обобщения

### Общая вычитательная игра

Рассмотренная игра является частным случаем **вычитательной игры** (subtraction game).

**Определение.** Вычитательная игра с множеством вычитания S ⊆ ℕ\{0} определяется:
- Позиция: n ∈ ℕ
- Допустимые ходы: n → n - s для s ∈ S, s ≤ n
- Проигрывает игрок, не могущий сделать ход

**Общая теорема.** Для вычитательной игры с S = {1, 2, ..., k}:
- P-позиции: n ≡ 0 (mod k+1)
- N-позиции: n ≢ 0 (mod k+1)

**Доказательство** аналогично доказательству для k = 3.

### Стратегия инвариантов

Ключевая идея анализа - нахождение **инварианта**, который сохраняется при оптимальной игре. В данном случае инвариантом является свойство "оставлять противнику позицию, кратную 4".

### Симметричная стратегия

Данная игра допускает **симметричную стратегию**: второй игрок может всегда отвечать таким ходом, чтобы сумма ходов обоих игроков равнялась 4.

## Связь с другими комбинаторными играми

### Ним с одной кучкой

Рассмотренная игра эквивалентна Ниму с одной кучкой и ограничением на максимальное количество забираемых камней. В классическом Ниме без ограничений первым ходом можно забрать всю кучку, поэтому все позиции n > 0 являются выигрышными.

### Игры с импарциальными правилами

Игра относится к классу **импарциальных игр** - игр, где множество допустимых ходов зависит только от текущей позиции, а не от того, какой игрок ходит.

## Заключение

Игра "Камешки" представляет собой канонический пример детерминированной игры с полной информацией, демонстрирующий фундаментальные принципы комбинаторной теории игр. Простота характеризации выигрышных позиций делает её идеальным объектом для изучения методов анализа комбинаторных игр, включая метод инвариантов, симметричные стратегии и теорию P- и N-позиций.

Полученные результаты имеют практическое значение в разработке игровых алгоритмов, искусственном интеллекте и теории вычислительной сложности игр.